<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>登录</title>
    <link rel="stylesheet" href="//cdn.bootcss.com/element-ui/1.4.2/theme-default/index.css">
    <link href="../commo.css" rel="stylesheet">
    <style>
        html,
        body,
        #app {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden
        }
        
        h1 {
            padding: 36px 0;
            margin: 0;
            margin-bottom: 15px;
            background: #444c61;
            color: #fff;
            font-weight: 100
        }
        
        .title {
            width: 80px;
            text-align: right;
        }
        
        #app {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
        }
        
        .panel {
            width: 30%;
            background: #fff;
            box-shadow: 0 0 150px rgba(0, 0, 0, .2)
        }
        
        .form-list {
            padding: 15px;
        }
        
        .panel-info {
            display: flex;
            justify-content: space-between
        }
        
        footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30px;
            text-align: center;
        }
        
        .link {
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="panel">
            <h1>
                <div class="title">登录</div>
            </h1>
            <el-form ref="form" label-width="60px" :model="form" class="form-list">
                <el-form-item label="用户名">
                    <el-input v-model="form.username" />
                </el-form-item>
                <el-form-item label="密码">
                    <el-input type="password" v-model="form.password" />
                </el-form-item>
                <!-- <el-form-item wei520810>
                    <div class="panel-info">
                        <el-button type="text">忘记密码？</el-button>
                    </div>
                </el-form-item> -->
                <el-form-item>
                    <el-button type="primary" @click="eventLogin">登录</el-button>
                    <el-button @click="eventSignup">注册</el-button>
                </el-form-item>
            </el-form>
        </div>
    </div>
    <script src="//cdn.bootcss.com/vue/2.3.4/vue.min.js"></script>
    <script src="//cdn.bootcss.com/element-ui/1.4.2/index.js"></script>
    <script src="//cdn.bootcss.com/axios/0.16.2/axios.min.js"></script>
    <script>
        var ajax = axios.create({
            baseURL: '/api/site'
        })
        var app = new Vue({
            el: '#app',
            data: {
                form: {
                    username: localStorage.getItem('username') || '',
                    password: localStorage.getItem('password') || '',
                }

            },
            computed: {
                formData: function() {
                    var a = [];
                    for (var attr in this.form) {
                        a.push(attr + '=' + this.form[attr])
                    }
                    return a.join('&')
                }
            },
            methods: {
                eventLogin: function() {
                    ajax({
                        method: 'post',
                        url: '/index/login',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                            'Accept': '*/*'
                        },
                        data: this.formData
                    }).then(
                        this._EventLoadSuccsee,
                        this._EventLoadFail
                    ).catch(this._EventLoadFail)
                },
                eventSignup: function() {
                    window.location.href = '/signup'
                },
                _EventLoadSuccsee: function(res) {
                    if (res.data.msg === 'ok') {
                        localStorage.clear();
                        localStorage.setItem('accessToken', res.data.data.accessToken);
                        localStorage.setItem('username', res.data.data.username);
                        localStorage.setItem('password', this.form.password);
                        this.$message({
                            message: '登录成功，即将跳转',
                            type: 'success',
                            onClose: function() {
                                window.location.href = "/";
                            }
                        })
                    } else {
                        throw res
                    }
                },
                _EventLoadFail: function(res) {
                    this.$message({
                        message: '登录失败，请检查帐号密码',
                        type: 'error',
                    })
                }
            }
        })
    </script>
</body>

</html>