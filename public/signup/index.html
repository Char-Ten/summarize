<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="//unpkg.com/element-ui/lib/theme-default/index.css">
    <link href="../commo.css" rel="stylesheet">
    <title>注册</title>
    <style>
        html,
        body,
        #app {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden
        }
        
        h1 {
            padding: 36px 0;
            margin: 0;
            margin-bottom: 15px;
            background: #444c61;
            color: #fff;
            font-weight: 100
        }
        
        .title {
            width: 80px;
            text-align: right;
        }
        
        #app {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
        }
        
        .panel {
            width: 30%;
            background: #fff;
            box-shadow: 0 0 150px rgba(0, 0, 0, .2)
        }
        
        .form-list {
            padding: 15px;
        }
        
        .panel-info {
            display: flex;
            justify-content: space-between
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="panel">
            <h1>
                <div class="title">注册</div>
            </h1>
            <el-form ref="form" label-width="60px" :model="form" class="form-list">
                <el-form-item label="用户名">
                    <el-input v-model="form.username" />
                </el-form-item>
                <el-form-item label="email">
                    <el-input type="email" v-model="form.email" />
                </el-form-item>
                <el-form-item label="密码">
                    <el-input type="password" v-model="form.password" />
                </el-form-item>
                <el-form-item label="联系人">
                    <el-input v-model="form.contacts" />
                </el-form-item>
                <el-form-item label="电话">
                    <el-input type="tel" v-model="form.phone" />
                </el-form-item>
                <el-form-item label="公司名">
                    <el-input v-model="form.company" />
                </el-form-item>
                <el-form-item>
                    <el-button :disabled="isSub" @click="eventSub" type="success">注册</el-button>
                </el-form-item>
            </el-form>
        </div>
    </div>
    <script src="//cdn.bootcss.com/vue/2.3.4/vue.min.js"></script>
    <script src="//unpkg.com/element-ui/lib/index.js"></script>
    <script src="//cdn.bootcss.com/axios/0.16.2/axios.min.js"></script>
    <script>
        var ajax = axios.create({
            baseURL: '/api/site'
        })
        var app = new Vue({
            el: '#app',
            data: {
                form: {
                    username: '',
                    password: '',
                    email: '',
                    company: '',
                    phone: '',
                    contacts: ''
                },
            },
            computed: {
                isSub: function() {
                    for (var attr in this.form) {
                        if (!this.form[attr]) {
                            return true
                        }
                    }
                    return false
                }
            },
            methods: {
                eventSub: function() {
                    ajax({
                        url: '/index/register',
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded;',
                        },
                        transformRequest: [function(data) {
                            var a = []
                            for (var attr in data) {
                                a.push(attr + '=' + data[attr])
                            }
                            return a.join('&')
                        }],
                        data: this.form
                    }).then(function(res) {
                        return res.data
                    }).then(function(res) {
                        if (res.msg === 'ok') {
                            app.$message({
                                type: 'success',
                                message: '注册成功，即将跳转',
                                onClose: function() {
                                    window.location.href = '/login'
                                }
                            })
                        } else {
                            app.$message({
                                type: 'error',
                                message: '注册失败，请稍候重试'
                            })
                        }
                    }, function() {
                        app.$message({
                            type: 'error',
                            message: '注册失败，请稍候重试'
                        })
                    })
                }
            }

        })
    </script>
</body>

</html>